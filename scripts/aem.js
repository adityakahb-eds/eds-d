import{$,$$,constants}from"./__constants.js";function sampleRUM(e,t){const o=()=>window.performance?window.performance.now():Date.now()-window.hlx.rum.firstReadTime;try{if(window.hlx=window.hlx||{},!window.hlx.rum){sampleRUM.enhance=()=>{};const e=new URLSearchParams(window.location.search).get("rum"),t=("on"===e?1:"high"===window.SAMPLE_PAGEVIEWS_AT_RATE&&10)||"low"===window.SAMPLE_PAGEVIEWS_AT_RATE&&1e3||100,n=Math.random().toString(36).slice(-4),a="off"!==e&&Math.random()*t<1;if(window.hlx.rum={weight:t,id:n,isSelected:a,firstReadTime:window.performance?window.performance.timeOrigin:Date.now(),sampleRUM:sampleRUM,queue:[],collector:(...e)=>window.hlx.rum.queue.push(e)},a){const e=e=>{const t={source:"undefined error",target:""};try{t.target=e.toString(),t.source=e.stack.split("\n").filter(e=>e.match(/https?:\/\//)).shift().replace(/at ([^ ]+) \((.+)\)/,"$1@$2").replace(/ at /,"@").trim()}catch(e){console.error(e)}return t};window.addEventListener("error",({error:t})=>{sampleRUM("error",e(t))}),window.addEventListener("unhandledrejection",({reason:t})=>{let o={source:"Unhandled Rejection",target:t||"Unknown"};t instanceof Error&&(o=e(t)),sampleRUM("error",o)}),sampleRUM.baseURL=sampleRUM.baseURL||new URL(window.RUM_BASE||"/",new URL("https://rum.hlx.page")),sampleRUM.collectBaseURL=sampleRUM.collectBaseURL||sampleRUM.baseURL,sampleRUM.sendPing=(e,o,a={})=>{const c=JSON.stringify({weight:t,id:n,referer:window.location.href,checkpoint:e,t:o,...a}),i=window.RUM_PARAMS?`?${new URLSearchParams(window.RUM_PARAMS).toString()}`:"",{href:s,origin:r}=new URL(`.rum/${t}${i}`,sampleRUM.collectBaseURL),l=r===window.location.origin?new Blob([c],{type:"application/json"}):c;navigator.sendBeacon(s,l),console.debug(`ping:${e}`,a)},sampleRUM.sendPing("top",o()),sampleRUM.enhance=()=>{if($(document,'script[src*="rum-enhancer"]'))return;const{enhancerVersion:e,enhancerHash:t}=sampleRUM.enhancerContext||{},o=document.createElement("script");t&&(o.integrity=t,o.setAttribute("crossorigin","anonymous")),o.src=new URL(`.rum/@adobe/helix-rum-enhancer@${e||"^2"}/src/index.js`,sampleRUM.baseURL).href,document.head.appendChild(o)},window.hlx.RUM_MANUAL_ENHANCE||sampleRUM.enhance()}}window.hlx.rum&&window.hlx.rum.isSelected&&e&&window.hlx.rum.collector(e,t,o()),document.dispatchEvent(new CustomEvent("rum",{detail:{checkpoint:e,data:t}}))}catch(e){console.error(e)}}function setup(){window.hlx=window.hlx||{},window.hlx.RUM_MASK_URL="full",window.hlx.RUM_MANUAL_ENHANCE=!0,window.hlx.codeBasePath="",window.hlx.lighthouse="on"===new URLSearchParams(window.location.search).get("lighthouse");const e=$(document,'script[src$="/scripts/scripts.js"]');if(e)try{[window.hlx.codeBasePath]=new URL(e.src).pathname.split("/scripts/scripts.js")}catch(e){console.log(e)}}function init(){setup(),sampleRUM.collectBaseURL=window.origin,sampleRUM()}function toClassName(e){return"string"==typeof e?e.toLowerCase().replace(/[^0-9a-z]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""):""}function toCamelCase(e){return toClassName(e).replace(/-([a-z])/g,e=>e[1].toUpperCase())}function readBlockConfig(e){const t={};return e.querySelectorAll(":scope > div").forEach(e=>{if(e.children){const o=[...e.children];if(o[1]){const n=o[1],a=toClassName(o[0].textContent);let c="";if(n.querySelector("a")){const e=[...n.querySelectorAll("a")];c=1===e.length?e[0].href:e.map(e=>e.href)}else if(n.querySelector("img")){const e=[...n.querySelectorAll("img")];c=1===e.length?e[0].src:e.map(e=>e.src)}else if(n.querySelector("p")){const e=[...n.querySelectorAll("p")];c=1===e.length?e[0].textContent:e.map(e=>e.textContent)}else c=e.children[1].textContent;t[a]=c}}}),t}async function loadCSS(e){return new Promise((t,o)=>{if($(document,`head > link[href="${e}"]`))t("");else{const n=document.createElement("link");n.rel="stylesheet",n.href=e,n.onload=t,n.onerror=o,document.head.append(n)}})}async function loadScript(e,t){return new Promise((o,n)=>{if($(document,`head > script[src="${e}"]`))o("");else{const a=document.createElement("script");if(a.src=e,t)for(const e in t)a.setAttribute(e,t[e]);a.onload=o,a.onerror=n,document.head.append(a)}})}function getMetadata(e,t=document){const o=e&&e.includes(":")?"property":"name";return[...t.head.querySelectorAll(`meta[${o}="${e}"]`)].map(e=>e.content).join(", ")||""}function getAllMetadata(e){return[...document.head.querySelectorAll(`meta[property^="${e}:"],meta[name^="${e}-"]`)].reduce((t,o)=>(t[toClassName(o.name?o.name.substring(e.length+1):o.getAttribute("property").split(":")[1])]=o.getAttribute("content"),t),{})}function createOptimizedPicture(e,t="",o=!1,n=[{media:"(min-width: 600px)",width:"2000"},{width:"750"}]){const a=new URL(e,window.location.href),c=document.createElement("picture"),{pathname:i}=a,s=i.substring(i.lastIndexOf(".")+1);return n.forEach(e=>{const t=document.createElement("source");e.media&&t.setAttribute("media",e.media),t.setAttribute("type","image/webp"),t.setAttribute("srcset",`${i}?width=${e.width}&format=webply&optimize=medium`),c.appendChild(t)}),n.forEach((e,a)=>{if(a<n.length-1){const t=document.createElement("source");e.media&&t.setAttribute("media",e.media),t.setAttribute("srcset",`${i}?width=${e.width}&format=${s}&optimize=medium`),c.appendChild(t)}else{const n=document.createElement("img");n.setAttribute("loading",o?"eager":"lazy"),n.setAttribute("alt",t),c.appendChild(n),n.setAttribute("src",`${i}?width=${e.width}&format=${s}&optimize=medium`)}}),c}function decorateTemplateAndTheme(){const e=(e,t)=>{t.split(",").forEach(t=>{e.classList.add(toClassName(t.trim()))})},t=getMetadata("template");t&&e(document.body,t);const o=getMetadata("theme");o&&e(document.body,o)}function wrapTextNodes(e){const t=["P","PRE","UL","OL","PICTURE","TABLE","H1","H2","H3","H4","H5","H6"],o=e=>{const t=document.createElement("p");t.append(...e.childNodes),e.append(t)};e.querySelectorAll(":scope > div > div").forEach(e=>{if(e.hasChildNodes()){!!e.firstElementChild&&t.some(t=>e.firstElementChild.tagName===t)?"PICTURE"===e.firstElementChild.tagName&&(e.children.length>1||e.textContent.trim())&&o(e):o(e)}})}function decorateIcon(e){let t=Array.from(e.classList).find(e=>e.startsWith("icon-"));t=t.substring(5);const o=document.createElement("i");o.className="icon",t.startsWith("gm--")?(o.textContent=t.substring(4),o.className="icon-gm"):o.className=`icon-fa fa-fw fa-brands fa-${t.substring(4)}`,e.replaceWith(o)}function decorateIcons(e){e.querySelectorAll("span.icon").forEach(e=>{decorateIcon(e)})}function decorateSections(e){$$(e,":scope > div").forEach(e=>{const t=[];let o=!1;[...e.children].forEach(e=>{if("DIV"===e.tagName||!o){const n=document.createElement("div");t.push(n),o="DIV"!==e.tagName,o&&n.classList.add("default-content-wrapper")}t[t.length-1].append(e)}),t.forEach(t=>e.append(t)),e.classList.add("section-content"),e.dataset.sectionStatus="initialized",e.style.display="none";const n=e.querySelector("div.section-metadata");if(n){const t=readBlockConfig(n);Object.keys(t).forEach(o=>{if("style"===o){t.style.split(",").filter(e=>e).map(e=>toClassName(e.trim())).forEach(t=>e.classList.add(t))}else e.dataset[toCamelCase(o)]=t[o]}),n.parentNode.remove()}})}function buildBlock(e,t){const o=Array.isArray(t)?t:[[t]],n=document.createElement("div");return n.classList.add(e),o.forEach(e=>{const t=document.createElement("div");e.forEach(e=>{const o=document.createElement("div");(e.elems?e.elems:[e]).forEach(e=>{e&&("string"==typeof e?o.innerHTML+=e:o.appendChild(e))}),t.appendChild(o)}),n.appendChild(t)}),n}async function loadBlock(e){const t=e.dataset.blockStatus;if("loading"!==t&&"loaded"!==t){e.dataset.blockStatus="loading";const{blockName:t}=e.dataset;try{const o=loadCSS(`${window.hlx.codeBasePath}/blocks/${t}/${t}.css`),n=new Promise(o=>{(async()=>{try{const o=await import(`${window.hlx.codeBasePath}/blocks/${t}/${t}.js`);o.default&&await o.default(e)}catch(e){console.log(`failed to load module for ${t}`,e)}o("")})()});await Promise.all([o,n])}catch(e){console.log(`failed to load block ${t}`,e)}e.dataset.blockStatus="loaded"}return e}function decorateBlock(e){const t=e.classList[0];if(t){e.classList.add("block"),e.dataset.blockName=t,e.dataset.blockStatus="initialized",wrapTextNodes(e);e.parentElement.classList.add(`${t}-wrapper`);const o=e.closest(".section-content");if(e.closest("main")){const e=document.createElement("section");o.parentNode.insertBefore(e,o),e.appendChild(o)}o&&o.classList.add(`${t}-section`)}}function decorateBlocks(e){$$(e,"div.section-content > div > div").forEach(decorateBlock)}async function loadSkipToMain(){const e=buildBlock("skiptomain","");return document.body.append(e),decorateBlock(e),loadBlock(e)}async function loadHeader(e){const t=buildBlock("header","");return e.append(t),decorateBlock(t),loadBlock(t)}async function loadFooter(e){const t=buildBlock("footer","");return e.append(t),decorateBlock(t),loadBlock(t)}async function loadSection(e,t){const o=e.dataset.sectionStatus;if(!o||"initialized"===o){e.dataset.sectionStatus="loading";const o=[...e.querySelectorAll("div.block")];for(let e=0;e<o.length;e+=1)constants.ignoredBlocks.includes(o[e].getAttribute("data-block-name"))||await loadBlock(o[e]);t&&await t(e),e.dataset.sectionStatus="loaded",e.style.display=null}}async function loadSections(e){const t=[...e.querySelectorAll("div.section-content")];for(let e=0;e<t.length;e+=1)await loadSection(t[e],()=>{}),0===e&&sampleRUM.enhance&&sampleRUM.enhance()}const AUDIENCES={mobile:()=>window.innerWidth<640,tablet:()=>window.innerWidth>=640&&window.innerWidth<1280,desktop:()=>window.innerWidth>=1280},pluginContext={getAllMetadata:getAllMetadata,getMetadata:getMetadata,loadCSS:loadCSS,loadScript:loadScript,sampleRUM:sampleRUM,toCamelCase:toCamelCase,toClassName:toClassName},pluginPath="../plugins/experimentation/src/index.js";init();export{AUDIENCES,buildBlock,createOptimizedPicture,decorateBlock,decorateBlocks,decorateIcons,decorateSections,decorateTemplateAndTheme,getAllMetadata,getMetadata,loadBlock,loadCSS,loadFooter,loadHeader,loadScript,loadSection,loadSections,loadSkipToMain,pluginContext,pluginPath,readBlockConfig,sampleRUM,setup,toCamelCase,toClassName,wrapTextNodes};